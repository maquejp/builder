{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "$id": "https://stackcraft.dev/schemas/field.json",
    "title": "Database Field Definition",
    "description": "Schema for database field definitions",
    "type": "object",
    "required": [
        "name",
        "type"
    ],
    "properties": {
        "name": {
            "type": "string",
            "description": "The field name",
            "minLength": 1,
            "pattern": "^[a-zA-Z][a-zA-Z0-9_]*$"
        },
        "type": {
            "type": "string",
            "description": "The field data type",
            "minLength": 1
        },
        "nullable": {
            "type": "boolean",
            "description": "Whether the field can be null",
            "default": true
        },
        "isPrimaryKey": {
            "type": "boolean",
            "description": "Whether this field is a primary key",
            "default": false
        },
        "isForeignKey": {
            "type": "boolean",
            "description": "Whether this field is a foreign key",
            "default": false
        },
        "foreignKey": {
            "type": "object",
            "description": "Foreign key reference definition (required if isForeignKey is true)",
            "required": [
                "referencedTable",
                "referencedColumn"
            ],
            "properties": {
                "referencedTable": {
                    "type": "string",
                    "description": "The name of the referenced table",
                    "minLength": 1
                },
                "referencedColumn": {
                    "type": "string",
                    "description": "The name of the referenced column",
                    "minLength": 1
                }
            },
            "additionalProperties": false
        },
        "default": {
            "type": "string",
            "description": "Default value or expression for the field"
        },
        "unique": {
            "type": "boolean",
            "description": "Whether this field should have a unique constraint",
            "default": false
        },
        "allowedValues": {
            "type": "array",
            "description": "Array of allowed values for this field (creates a check constraint)",
            "items": {
                "oneOf": [
                    {
                        "type": "string"
                    },
                    {
                        "type": "number"
                    }
                ]
            },
            "minItems": 1,
            "uniqueItems": true
        },
        "comment": {
            "type": "string",
            "description": "Comment or description for the field"
        },
        "trigger": {
            "type": "object",
            "description": "Trigger configuration for this field",
            "properties": {
                "enabled": {
                    "type": "boolean",
                    "description": "Whether to generate a trigger for this field",
                    "default": false
                },
                "event": {
                    "type": "string",
                    "description": "Trigger event type",
                    "enum": [
                        "before_insert",
                        "before_update",
                        "before_insert_update",
                        "after_insert",
                        "after_update",
                        "after_insert_update"
                    ],
                    "default": "before_update"
                },
                "action": {
                    "type": "string",
                    "description": "Action to perform in the trigger (e.g., 'systimestamp', 'user', custom PL/SQL)",
                    "default": "systimestamp"
                },
                "condition": {
                    "type": "string",
                    "description": "Optional condition for when the trigger should fire (e.g., 'WHEN (OLD.status != NEW.status)')"
                }
            },
            "required": [
                "enabled"
            ],
            "additionalProperties": false
        }
    },
    "additionalProperties": false,
    "if": {
        "properties": {
            "isForeignKey": {
                "const": true
            }
        }
    },
    "then": {
        "required": [
            "foreignKey"
        ]
    }
}